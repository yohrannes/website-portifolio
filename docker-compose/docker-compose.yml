services:
  webport:
    build:
      context: ..
      dockerfile: build-app/Dockerfile
    container_name: webport
    expose:
      - "5000"
    networks:
      - portifolio-network

  nginx:
    build:
      context: ..
      dockerfile: build-app/Dockerfile-nginx
    container_name: nginx
    ports:
      - "80:8080"
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf
      - ./nginx/conf.d/yohrannes.com.conf:/etc/nginx/conf.d/yohrannes.com.conf
      - /var/log/nginx:/var/log/nginx
    depends_on:
      - webport
    networks:
      - portifolio-network

  grafana:
    image: grafana/grafana
    container_name: grafana
    environment:
      - GF_SERVER_ROOT_URL=http://yohrannes.com/grafana
      - GF_SERVER_SERVE_FROM_SUB_PATH=true
    ports:
      - "3000:3000"
    networks:
      - portifolio-network

  prometheus:
    image: prom/prometheus
    container_name: prometheus
    networks:
      - portifolio-network
    ports:
      - "9090:9090"
    volumes:
      - ./observability/prometheus.yml:/etc/prometheus/prometheus.yml

networks:
  portifolio-network:
    driver: bridge